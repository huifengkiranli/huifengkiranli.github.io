<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"huifengkiranli.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.12.1","exturl":false,"sidebar":{"position":"left","Pisces | Gemini":260,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="TGI (Target group index) is an index providing valuable and comparable insight on consumer demographics, category, psychographics and lifestyle. It is frequently used in understanding the target marke">
<meta property="og:type" content="article">
<meta property="og:title" content="E-commerce TGI analysis">
<meta property="og:url" content="http://huifengkiranli.github.io/2019/12/26/data%20analysis6/index.html">
<meta property="og:site_name" content="Huifeng&#39;s Blog">
<meta property="og:description" content="TGI (Target group index) is an index providing valuable and comparable insight on consumer demographics, category, psychographics and lifestyle. It is frequently used in understanding the target marke">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-12-25T16:36:27.000Z">
<meta property="article:modified_time" content="2022-07-07T17:47:13.750Z">
<meta property="article:author" content="Huifeng (Kiran) Li">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="CRM">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://huifengkiranli.github.io/2019/12/26/data%20analysis6/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://huifengkiranli.github.io/2019/12/26/data%20analysis6/","path":"2019/12/26/data analysis6/","title":"E-commerce TGI analysis"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>E-commerce TGI analysis | Huifeng's Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Huifeng's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Do what you love, Love what you do.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Huifeng (Kiran) Li"
      src="/images/huifengpic.jpg">
  <p class="site-author-name" itemprop="name">Huifeng (Kiran) Li</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:huifeng.kiran.li@outlook.com" title="E-Mail → mailto:huifeng.kiran.li@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://cn.linkedin.com/in/kiranli" title="LinkedIn → https:&#x2F;&#x2F;cn.linkedin.com&#x2F;in&#x2F;kiranli" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i>LinkedIn</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://huifengkiranli.github.io/2019/12/26/data%20analysis6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/huifengpic.jpg">
      <meta itemprop="name" content="Huifeng (Kiran) Li">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Huifeng's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="E-commerce TGI analysis | Huifeng's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          E-commerce TGI analysis
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-12-26 00:36:27" itemprop="dateCreated datePublished" datetime="2019-12-26T00:36:27+08:00">2019-12-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Data-analysis/" itemprop="url" rel="index"><span itemprop="name">Data analysis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>TGI (Target group index) is an index providing valuable and comparable insight on consumer demographics, category, psychographics and lifestyle. It is frequently used in understanding the target markets and to aid marketing and advertising decisions.</p>
<span id="more"></span>



<h1 id="TGI指标：Python分析电商客群特征"><a href="#TGI指标：Python分析电商客群特征" class="headerlink" title="TGI指标：Python分析电商客群特征"></a>TGI指标：Python分析电商客群特征</h1><h1 id="电商全国销售数据，对比分析各省市销售额"><a href="#电商全国销售数据，对比分析各省市销售额" class="headerlink" title="电商全国销售数据，对比分析各省市销售额"></a>电商全国销售数据，对比分析各省市销售额</h1><h1 id="数据概览"><a href="#数据概览" class="headerlink" title="数据概览"></a>数据概览</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd </span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os </span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">os.chdir(<span class="string">&#x27;/Users/hui2046/Downloads/SQL+Python/TGI指数_淘宝用户群分析&#x27;</span>)</span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;TGI数据.xlsx&#x27;</span>)</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>品牌名称</th>
      <th>买家昵称</th>
      <th>付款日期</th>
      <th>订单状态</th>
      <th>实付金额</th>
      <th>邮费</th>
      <th>省份</th>
      <th>城市</th>
      <th>购买数量</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>viva la vida</td>
      <td>做快淘饭</td>
      <td>2019-04-18 00:03:00</td>
      <td>交易成功</td>
      <td>22.32</td>
      <td>0</td>
      <td>北京</td>
      <td>北京市</td>
      <td>1</td>
    </tr>
    <tr>
      <td>1</td>
      <td>viva la vida</td>
      <td>作自有世祟</td>
      <td>2019-02-17 00:03:51</td>
      <td>交易成功</td>
      <td>87.00</td>
      <td>0</td>
      <td>上海</td>
      <td>上海市</td>
      <td>1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>viva la vida</td>
      <td>作雪白室</td>
      <td>2019-04-18 00:01:43</td>
      <td>交易成功</td>
      <td>97.66</td>
      <td>0</td>
      <td>福建省</td>
      <td>福州市</td>
      <td>2</td>
    </tr>
    <tr>
      <td>3</td>
      <td>viva la vida</td>
      <td>作美女购物主</td>
      <td>2019-01-11 23:35:01</td>
      <td>交易成功</td>
      <td>37.23</td>
      <td>0</td>
      <td>河南省</td>
      <td>安阳市</td>
      <td>3</td>
    </tr>
    <tr>
      <td>4</td>
      <td>viva la vida</td>
      <td>作美女购物主</td>
      <td>2019-02-18 14:16:03</td>
      <td>交易成功</td>
      <td>29.50</td>
      <td>0</td>
      <td>河南省</td>
      <td>安阳市</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 28832 entries, 0 to 28831
Data columns (total 9 columns):
品牌名称    28832 non-null object
买家昵称    28832 non-null object
付款日期    28832 non-null datetime64[ns]
订单状态    28832 non-null object
实付金额    28832 non-null float64
邮费      28832 non-null int64
省份      28832 non-null object
城市      28832 non-null object
购买数量    28832 non-null int64
dtypes: datetime64[ns](1), float64(1), int64(2), object(5)
memory usage: 2.0+ MB
</code></pre>
<h1 id="分类客户并计算平均支付金额以贴标客户"><a href="#分类客户并计算平均支付金额以贴标客户" class="headerlink" title="分类客户并计算平均支付金额以贴标客户"></a>分类客户并计算平均支付金额以贴标客户</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gp_user = df.groupby(<span class="string">&#x27;买家昵称&#x27;</span>)[<span class="string">&#x27;实付金额&#x27;</span>].mean().reset_index()</span><br><span class="line">gp_user.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>实付金额</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>49.450</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>22.000</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>34.570</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>37.475</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>13.500</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">if_high</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">if</span> x &gt; <span class="number">50</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;高客单&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;低客单&#x27;</span></span><br><span class="line"></span><br><span class="line">gp_user[<span class="string">&#x27;客单类别&#x27;</span>] = gp_user[<span class="string">&#x27;实付金额&#x27;</span>].apply(if_high)</span><br><span class="line">gp_user.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>实付金额</th>
      <th>客单类别</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>49.450</td>
      <td>低客单</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>22.000</td>
      <td>低客单</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>34.570</td>
      <td>低客单</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>37.475</td>
      <td>低客单</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>13.500</td>
      <td>低客单</td>
    </tr>
  </tbody>
</table>
</div>



<h1 id="客单数据去重，和地域数据合并"><a href="#客单数据去重，和地域数据合并" class="headerlink" title="客单数据去重，和地域数据合并"></a>客单数据去重，和地域数据合并</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_dup = df.loc[df.duplicated(<span class="string">&#x27;买家昵称&#x27;</span>)== <span class="literal">False</span>,:]</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df_merge = pd.merge(gp_user,df_dup,left_on=<span class="string">&#x27;买家昵称&#x27;</span>,right_on=<span class="string">&#x27;买家昵称&#x27;</span>,</span><br><span class="line">                   how =<span class="string">&#x27;inner&#x27;</span>)</span><br><span class="line">df_merge.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>实付金额_x</th>
      <th>客单类别</th>
      <th>品牌名称</th>
      <th>付款日期</th>
      <th>订单状态</th>
      <th>实付金额_y</th>
      <th>邮费</th>
      <th>省份</th>
      <th>城市</th>
      <th>购买数量</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>49.450</td>
      <td>低客单</td>
      <td>viva la vida</td>
      <td>2019-02-04 17:49:34.000</td>
      <td>交易成功</td>
      <td>49.450</td>
      <td>0</td>
      <td>上海</td>
      <td>上海市</td>
      <td>1</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>22.000</td>
      <td>低客单</td>
      <td>viva la vida</td>
      <td>2019-01-29 14:17:15.000</td>
      <td>交易成功</td>
      <td>22.000</td>
      <td>0</td>
      <td>江苏省</td>
      <td>南京市</td>
      <td>1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>34.570</td>
      <td>低客单</td>
      <td>viva la vida</td>
      <td>2019-01-11 03:46:18.000</td>
      <td>交易成功</td>
      <td>34.570</td>
      <td>0</td>
      <td>山东省</td>
      <td>烟台市</td>
      <td>2</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>37.475</td>
      <td>低客单</td>
      <td>viva la vida</td>
      <td>2019-01-11 02:26:33.000</td>
      <td>交易成功</td>
      <td>37.475</td>
      <td>0</td>
      <td>上海</td>
      <td>上海市</td>
      <td>3</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>13.500</td>
      <td>低客单</td>
      <td>viva la vida</td>
      <td>2019-06-28 16:53:26.458</td>
      <td>交易成功</td>
      <td>13.500</td>
      <td>0</td>
      <td>广东省</td>
      <td>揭阳市</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>



<h1 id="统计各省市高低客单人数pivot-table"><a href="#统计各省市高低客单人数pivot-table" class="headerlink" title="统计各省市高低客单人数pivot_table"></a>统计各省市高低客单人数pivot_table</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先筛选出需要的列</span></span><br><span class="line">df_merge = df_merge[[<span class="string">&#x27;买家昵称&#x27;</span>,<span class="string">&#x27;客单类别&#x27;</span>,<span class="string">&#x27;省份&#x27;</span>,<span class="string">&#x27;城市&#x27;</span>]]</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pivot_table</span></span><br><span class="line">result = pd.pivot_table(df_merge,index = [<span class="string">&#x27;省份&#x27;</span>,<span class="string">&#x27;城市&#x27;</span>],columns=<span class="string">&#x27;客单类别&#x27;</span>,aggfunc=<span class="string">&#x27;count&#x27;</span>)</span><br><span class="line">result.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead tr th &#123;
    text-align: left;
&#125;

.dataframe thead tr:last-of-type th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">买家昵称</th>
    </tr>
    <tr>
      <th></th>
      <th>客单类别</th>
      <th>低客单</th>
      <th>高客单</th>
    </tr>
    <tr>
      <th>省份</th>
      <th>城市</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>上海</td>
      <td>上海市</td>
      <td>2818.0</td>
      <td>2374.0</td>
    </tr>
    <tr>
      <td rowspan="4" valign="top">云南省</td>
      <td>临沧市</td>
      <td>3.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <td>丽江市</td>
      <td>1.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <td>保山市</td>
      <td>6.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <td>大理白族自治州</td>
      <td>9.0</td>
      <td>8.0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#高低客单数据合并</span></span><br><span class="line">tgi = pd.merge(result[<span class="string">&#x27;买家昵称&#x27;</span>][<span class="string">&#x27;高客单&#x27;</span>].reset_index(),result[<span class="string">&#x27;买家昵称&#x27;</span>][<span class="string">&#x27;低客单&#x27;</span>].reset_index(),</span><br><span class="line">               on=[<span class="string">&#x27;省份&#x27;</span>,<span class="string">&#x27;城市&#x27;</span>],how=<span class="string">&#x27;inner&#x27;</span>)</span><br><span class="line">tgi.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>省份</th>
      <th>城市</th>
      <th>高客单</th>
      <th>低客单</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>上海</td>
      <td>上海市</td>
      <td>2374.0</td>
      <td>2818.0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>云南省</td>
      <td>临沧市</td>
      <td>2.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>云南省</td>
      <td>丽江市</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>云南省</td>
      <td>保山市</td>
      <td>2.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>云南省</td>
      <td>大理白族自治州</td>
      <td>8.0</td>
      <td>9.0</td>
    </tr>
  </tbody>
</table>
</div>



<h1 id="计算各省市客单总数和高客单占比"><a href="#计算各省市客单总数和高客单占比" class="headerlink" title="计算各省市客单总数和高客单占比"></a>计算各省市客单总数和高客单占比</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tgi[<span class="string">&#x27;客单总数&#x27;</span>] = tgi[<span class="string">&#x27;高客单&#x27;</span>] + tgi[<span class="string">&#x27;低客单&#x27;</span>]</span><br><span class="line">tgi[<span class="string">&#x27;高客单占比&#x27;</span>] = tgi[<span class="string">&#x27;高客单&#x27;</span>]/ tgi[<span class="string">&#x27;客单总数&#x27;</span>]</span><br><span class="line"></span><br><span class="line">tgi.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>省份</th>
      <th>城市</th>
      <th>高客单</th>
      <th>低客单</th>
      <th>高客单占比</th>
      <th>总人数</th>
      <th>客单总数</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>上海</td>
      <td>上海市</td>
      <td>2374.0</td>
      <td>2818.0</td>
      <td>0.457242</td>
      <td>5192.0</td>
      <td>5192.0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>云南省</td>
      <td>临沧市</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>0.400000</td>
      <td>5.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>云南省</td>
      <td>丽江市</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>0.750000</td>
      <td>4.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>云南省</td>
      <td>保山市</td>
      <td>2.0</td>
      <td>6.0</td>
      <td>0.250000</td>
      <td>8.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>云南省</td>
      <td>大理白族自治州</td>
      <td>8.0</td>
      <td>9.0</td>
      <td>0.470588</td>
      <td>17.0</td>
      <td>17.0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查空值并删除</span></span><br><span class="line">tgi.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 346 entries, 0 to 345
Data columns (total 7 columns):
省份       346 non-null object
城市       346 non-null object
高客单      332 non-null float64
低客单      329 non-null float64
高客单占比    315 non-null float64
总人数      315 non-null float64
客单总数     315 non-null float64
dtypes: float64(5), object(2)
memory usage: 31.6+ KB
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tgi.dropna()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>省份</th>
      <th>城市</th>
      <th>高客单</th>
      <th>低客单</th>
      <th>高客单占比</th>
      <th>总人数</th>
      <th>客单总数</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>上海</td>
      <td>上海市</td>
      <td>2374.0</td>
      <td>2818.0</td>
      <td>0.457242</td>
      <td>5192.0</td>
      <td>5192.0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>云南省</td>
      <td>临沧市</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>0.400000</td>
      <td>5.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>云南省</td>
      <td>丽江市</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>0.750000</td>
      <td>4.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>云南省</td>
      <td>保山市</td>
      <td>2.0</td>
      <td>6.0</td>
      <td>0.250000</td>
      <td>8.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>云南省</td>
      <td>大理白族自治州</td>
      <td>8.0</td>
      <td>9.0</td>
      <td>0.470588</td>
      <td>17.0</td>
      <td>17.0</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>341</td>
      <td>黑龙江省</td>
      <td>绥化市</td>
      <td>2.0</td>
      <td>14.0</td>
      <td>0.125000</td>
      <td>16.0</td>
      <td>16.0</td>
    </tr>
    <tr>
      <td>342</td>
      <td>黑龙江省</td>
      <td>鸡西市</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>0.333333</td>
      <td>9.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <td>343</td>
      <td>黑龙江省</td>
      <td>鹤岗市</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.666667</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <td>344</td>
      <td>黑龙江省</td>
      <td>黑河市</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>0.428571</td>
      <td>7.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <td>345</td>
      <td>黑龙江省</td>
      <td>齐齐哈尔市</td>
      <td>10.0</td>
      <td>14.0</td>
      <td>0.416667</td>
      <td>24.0</td>
      <td>24.0</td>
    </tr>
  </tbody>
</table>
<p>315 rows × 7 columns</p>
</div>



<h1 id="计算高客单总占比"><a href="#计算高客单总占比" class="headerlink" title="计算高客单总占比"></a>计算高客单总占比</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">total_percentage = tgi[<span class="string">&#x27;高客单&#x27;</span>].<span class="built_in">sum</span>()/tgi[<span class="string">&#x27;客单总数&#x27;</span>].<span class="built_in">sum</span>()</span><br><span class="line">total_percentage</span><br></pre></td></tr></table></figure>




<pre><code>0.4163255849872577
</code></pre>
<h1 id="计算各城市高客单TGI指数"><a href="#计算各城市高客单TGI指数" class="headerlink" title="计算各城市高客单TGI指数"></a>计算各城市高客单TGI指数</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tgi[<span class="string">&#x27;高客单TGI&#x27;</span>] = tgi[<span class="string">&#x27;高客单占比&#x27;</span>]/total_percentage * <span class="number">100</span></span><br><span class="line">tgi = tgi.sort_values(<span class="string">&#x27;高客单TGI&#x27;</span>,ascending = <span class="literal">False</span>)</span><br><span class="line">tgi.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>省份</th>
      <th>城市</th>
      <th>高客单</th>
      <th>低客单</th>
      <th>高客单占比</th>
      <th>总人数</th>
      <th>客单总数</th>
      <th>高客单TGI</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>149</td>
      <td>新疆维吾尔自治区</td>
      <td>哈密市</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>0.800000</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>192.157299</td>
    </tr>
    <tr>
      <td>152</td>
      <td>新疆维吾尔自治区</td>
      <td>巴音郭楞蒙古自治州</td>
      <td>10.0</td>
      <td>3.0</td>
      <td>0.769231</td>
      <td>13.0</td>
      <td>13.0</td>
      <td>184.766634</td>
    </tr>
    <tr>
      <td>2</td>
      <td>云南省</td>
      <td>丽江市</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>0.750000</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>180.147468</td>
    </tr>
    <tr>
      <td>277</td>
      <td>甘肃省</td>
      <td>白银市</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>0.750000</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>180.147468</td>
    </tr>
    <tr>
      <td>34</td>
      <td>吉林省</td>
      <td>辽源市</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.666667</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>160.131083</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 样本选择中，应选大于客单总数平均值</span></span><br><span class="line">tgi.loc[tgi[<span class="string">&#x27;客单总数&#x27;</span>] &gt; tgi[<span class="string">&#x27;客单总数&#x27;</span>].mean(),:].head(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>省份</th>
      <th>城市</th>
      <th>高客单</th>
      <th>低客单</th>
      <th>高客单占比</th>
      <th>总人数</th>
      <th>客单总数</th>
      <th>高客单TGI</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>287</td>
      <td>福建省</td>
      <td>福州市</td>
      <td>145.0</td>
      <td>135.0</td>
      <td>0.517857</td>
      <td>280.0</td>
      <td>280.0</td>
      <td>124.387537</td>
    </tr>
    <tr>
      <td>124</td>
      <td>广东省</td>
      <td>珠海市</td>
      <td>49.0</td>
      <td>52.0</td>
      <td>0.485149</td>
      <td>101.0</td>
      <td>101.0</td>
      <td>116.531035</td>
    </tr>
    <tr>
      <td>27</td>
      <td>北京</td>
      <td>北京市</td>
      <td>1203.0</td>
      <td>1298.0</td>
      <td>0.481008</td>
      <td>2501.0</td>
      <td>2501.0</td>
      <td>115.536401</td>
    </tr>
    <tr>
      <td>283</td>
      <td>福建省</td>
      <td>厦门市</td>
      <td>105.0</td>
      <td>118.0</td>
      <td>0.470852</td>
      <td>223.0</td>
      <td>223.0</td>
      <td>113.097065</td>
    </tr>
    <tr>
      <td>111</td>
      <td>广东省</td>
      <td>佛山市</td>
      <td>118.0</td>
      <td>135.0</td>
      <td>0.466403</td>
      <td>253.0</td>
      <td>253.0</td>
      <td>112.028465</td>
    </tr>
    <tr>
      <td>173</td>
      <td>江西省</td>
      <td>南昌市</td>
      <td>63.0</td>
      <td>73.0</td>
      <td>0.463235</td>
      <td>136.0</td>
      <td>136.0</td>
      <td>111.267554</td>
    </tr>
    <tr>
      <td>46</td>
      <td>四川省</td>
      <td>成都市</td>
      <td>287.0</td>
      <td>334.0</td>
      <td>0.462158</td>
      <td>621.0</td>
      <td>621.0</td>
      <td>111.008746</td>
    </tr>
    <tr>
      <td>0</td>
      <td>上海</td>
      <td>上海市</td>
      <td>2374.0</td>
      <td>2818.0</td>
      <td>0.457242</td>
      <td>5192.0</td>
      <td>5192.0</td>
      <td>109.827963</td>
    </tr>
    <tr>
      <td>164</td>
      <td>江苏省</td>
      <td>无锡市</td>
      <td>135.0</td>
      <td>162.0</td>
      <td>0.454545</td>
      <td>297.0</td>
      <td>297.0</td>
      <td>109.180284</td>
    </tr>
    <tr>
      <td>120</td>
      <td>广东省</td>
      <td>深圳市</td>
      <td>438.0</td>
      <td>528.0</td>
      <td>0.453416</td>
      <td>966.0</td>
      <td>966.0</td>
      <td>108.909028</td>
    </tr>
  </tbody>
</table>
</div>



<h1 id="保存数据到新Excel"><a href="#保存数据到新Excel" class="headerlink" title="保存数据到新Excel"></a>保存数据到新Excel</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tgi.to_excel(<span class="string">&#x27;TGI.xlsx&#x27;</span>,index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"># Python</a>
              <a href="/tags/CRM/" rel="tag"># CRM</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/12/20/data%20analysis7/" rel="prev" title="KPI Analysis_Python Pivot_table">
                  <i class="fa fa-chevron-left"></i> KPI Analysis_Python Pivot_table
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/01/06/data%20analysis5/" rel="next" title="E-commerce customer segmentation_RFM model">
                  E-commerce customer segmentation_RFM model <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Huifeng (Kiran) Li</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>

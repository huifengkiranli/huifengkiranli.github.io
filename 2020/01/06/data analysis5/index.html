<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"huifengkiranli.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.12.1","exturl":false,"sidebar":{"position":"left","Pisces | Gemini":260,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="This project is aming to analyze customer segmentation based on RFM model (Recency, Frequency and Monetary）through Python.">
<meta property="og:type" content="article">
<meta property="og:title" content="E-commerce customer segmentation_RFM model">
<meta property="og:url" content="http://huifengkiranli.github.io/2020/01/06/data%20analysis5/index.html">
<meta property="og:site_name" content="Huifeng&#39;s Blog">
<meta property="og:description" content="This project is aming to analyze customer segmentation based on RFM model (Recency, Frequency and Monetary）through Python.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-01-05T16:36:27.000Z">
<meta property="article:modified_time" content="2022-07-07T17:30:42.314Z">
<meta property="article:author" content="Huifeng (Kiran) Li">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="CRM">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://huifengkiranli.github.io/2020/01/06/data%20analysis5/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://huifengkiranli.github.io/2020/01/06/data%20analysis5/","path":"2020/01/06/data analysis5/","title":"E-commerce customer segmentation_RFM model"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>E-commerce customer segmentation_RFM model | Huifeng's Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Huifeng's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Do what you love, Love what you do.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Huifeng (Kiran) Li"
      src="/images/huifengpic.jpg">
  <p class="site-author-name" itemprop="name">Huifeng (Kiran) Li</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:huifeng.kiran.li@outlook.com" title="E-Mail → mailto:huifeng.kiran.li@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://cn.linkedin.com/in/kiranli" title="LinkedIn → https:&#x2F;&#x2F;cn.linkedin.com&#x2F;in&#x2F;kiranli" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i>LinkedIn</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://huifengkiranli.github.io/2020/01/06/data%20analysis5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/huifengpic.jpg">
      <meta itemprop="name" content="Huifeng (Kiran) Li">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Huifeng's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="E-commerce customer segmentation_RFM model | Huifeng's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          E-commerce customer segmentation_RFM model
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-01-06 00:36:27" itemprop="dateCreated datePublished" datetime="2020-01-06T00:36:27+08:00">2020-01-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Data-analysis/" itemprop="url" rel="index"><span itemprop="name">Data analysis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>This project is aming to analyze customer segmentation based on RFM model (Recency, Frequency and Monetary）through Python. </p>
<span id="more"></span>





<h1 id="RFM客户分层模型：精细化运营分析"><a href="#RFM客户分层模型：精细化运营分析" class="headerlink" title="RFM客户分层模型：精细化运营分析"></a>RFM客户分层模型：精细化运营分析</h1><h2 id="问题：电商公司客户粘度如何？如何精细化客户群体及进一步营销管理？"><a href="#问题：电商公司客户粘度如何？如何精细化客户群体及进一步营销管理？" class="headerlink" title="问题：电商公司客户粘度如何？如何精细化客户群体及进一步营销管理？"></a>问题：电商公司客户粘度如何？如何精细化客户群体及进一步营销管理？</h2><h2 id="该数据共包含28833条记录，9个字段"><a href="#该数据共包含28833条记录，9个字段" class="headerlink" title="该数据共包含28833条记录，9个字段"></a>该数据共包含28833条记录，9个字段</h2><h1 id="Import-data"><a href="#Import-data" class="headerlink" title="Import data"></a>Import data</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd </span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os </span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">os.chdir(<span class="string">&#x27;/Users/hui2046/Downloads/SQL+Python/RFM数据&#x27;</span>)</span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;电商用户RFM分析.xlsx&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="数据概览"><a href="#数据概览" class="headerlink" title="数据概览"></a>数据概览</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 28833 entries, 0 to 28832
Data columns (total 9 columns):
品牌名称    28833 non-null object
买家昵称    28833 non-null object
付款日期    28833 non-null datetime64[ns]
订单状态    28833 non-null object
实付金额    28833 non-null int64
邮费      28833 non-null int64
省份      28833 non-null object
城市      28832 non-null object
购买数量    28833 non-null int64
dtypes: datetime64[ns](1), int64(3), object(5)
memory usage: 2.0+ MB
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>品牌名称</th>
      <th>买家昵称</th>
      <th>付款日期</th>
      <th>订单状态</th>
      <th>实付金额</th>
      <th>邮费</th>
      <th>省份</th>
      <th>城市</th>
      <th>购买数量</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>JOJO</td>
      <td>叫我李2</td>
      <td>2019-01-01 00:17:59</td>
      <td>交易成功</td>
      <td>186</td>
      <td>6</td>
      <td>上海</td>
      <td>上海市</td>
      <td>1</td>
    </tr>
    <tr>
      <td>1</td>
      <td>JOJO</td>
      <td>0cyb1992</td>
      <td>2019-01-01 00:59:54</td>
      <td>交易成功</td>
      <td>145</td>
      <td>0</td>
      <td>广东省</td>
      <td>广州市</td>
      <td>1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>JOJO</td>
      <td>萝污萌莉</td>
      <td>2019-01-01 07:48:48</td>
      <td>交易成功</td>
      <td>194</td>
      <td>8</td>
      <td>山东省</td>
      <td>东营市</td>
      <td>1</td>
    </tr>
    <tr>
      <td>3</td>
      <td>JOJO</td>
      <td>atblovemyy</td>
      <td>2019-01-01 09:15:49</td>
      <td>付款以后用户退款成功，交易自动关闭</td>
      <td>84</td>
      <td>0</td>
      <td>江苏省</td>
      <td>镇江市</td>
      <td>1</td>
    </tr>
    <tr>
      <td>4</td>
      <td>JOJO</td>
      <td>小星期鱼</td>
      <td>2019-01-01 09:59:33</td>
      <td>付款以后用户退款成功，交易自动关闭</td>
      <td>74</td>
      <td>0</td>
      <td>上海</td>
      <td>上海市</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看多少种订单状态，[].unique()</span></span><br><span class="line"></span><br><span class="line">df[<span class="string">&#x27;订单状态&#x27;</span>].unique()</span><br></pre></td></tr></table></figure>




<pre><code>array([&#39;交易成功&#39;, &#39;付款以后用户退款成功，交易自动关闭&#39;], dtype=object)
</code></pre>
<h1 id="数据清洗"><a href="#数据清洗" class="headerlink" title="数据清洗"></a>数据清洗</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 选取订单状态为‘交易成功’的记录</span></span><br><span class="line"></span><br><span class="line">df = df.loc[df[<span class="string">&#x27;订单状态&#x27;</span>] == <span class="string">&#x27;交易成功&#x27;</span>,:]</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 选取需要的关键字段作表格[[&#x27;&#x27;]],RFM:用户名，付款日期，支付金额</span></span><br><span class="line"></span><br><span class="line">df = df[[<span class="string">&#x27;买家昵称&#x27;</span>,<span class="string">&#x27;付款日期&#x27;</span>,<span class="string">&#x27;实付金额&#x27;</span>]]</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>付款日期</th>
      <th>实付金额</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>叫我李2</td>
      <td>2019-01-01 00:17:59</td>
      <td>186</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0cyb1992</td>
      <td>2019-01-01 00:59:54</td>
      <td>145</td>
    </tr>
    <tr>
      <td>2</td>
      <td>萝污萌莉</td>
      <td>2019-01-01 07:48:48</td>
      <td>194</td>
    </tr>
    <tr>
      <td>5</td>
      <td>重碎叠</td>
      <td>2019-01-01 10:00:07</td>
      <td>197</td>
    </tr>
    <tr>
      <td>6</td>
      <td>iho_jann</td>
      <td>2019-01-01 10:00:08</td>
      <td>168</td>
    </tr>
  </tbody>
</table>
</div>



<h1 id="RFM模型建立"><a href="#RFM模型建立" class="headerlink" title="RFM模型建立"></a>RFM模型建立</h1><h2 id="R值：计算最近未消费日天数"><a href="#R值：计算最近未消费日天数" class="headerlink" title="R值：计算最近未消费日天数"></a>R值：计算最近未消费日天数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 选取出最近的交易日期</span></span><br><span class="line"></span><br><span class="line">r = df.groupby(<span class="string">&#x27;买家昵称&#x27;</span>)[<span class="string">&#x27;付款日期&#x27;</span>].<span class="built_in">max</span>().reset_index()</span><br><span class="line">r.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>付款日期</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>2019-02-04 17:49:34.000</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>2019-01-29 14:17:15.000</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>2019-01-11 03:46:18.000</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>2019-01-11 02:26:33.000</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>2019-06-28 16:53:26.458</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 计算未消费的天数 to_datetime, dt.days</span></span><br><span class="line"></span><br><span class="line">r[<span class="string">&#x27;R&#x27;</span>] = (pd.to_datetime(<span class="string">&#x27;2019-7-1&#x27;</span>) - r[<span class="string">&#x27;付款日期&#x27;</span>]).dt.days</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 选取需要的字段建表格[[&#x27;&#x27;]]</span></span><br><span class="line"></span><br><span class="line">r = r[[<span class="string">&#x27;买家昵称&#x27;</span>,<span class="string">&#x27;R&#x27;</span>]]</span><br><span class="line">r.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>R</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>146</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>152</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>170</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>170</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="F值：计算消费频率"><a href="#F值：计算消费频率" class="headerlink" title="F值：计算消费频率"></a>F值：计算消费频率</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 引入’日期标签‘字符串列，用于稍后合并’一天内多次购买‘为一次</span></span><br><span class="line"></span><br><span class="line">df[<span class="string">&#x27;日期标签&#x27;</span>] = df[<span class="string">&#x27;付款日期&#x27;</span>].astype(<span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按&#x27;买家昵称&#x27;,&#x27;日期标签&#x27;分组计算消费频率（按天）</span></span><br><span class="line">dup_f = df.groupby([<span class="string">&#x27;买家昵称&#x27;</span>,<span class="string">&#x27;日期标签&#x27;</span>])[<span class="string">&#x27;付款日期&#x27;</span>].count().reset_index()</span><br><span class="line">dup_f.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>日期标签</th>
      <th>付款日期</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>2019-02-04 17:49:34.000</td>
      <td>1</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>2019-01-29 14:17:15.000</td>
      <td>1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>2019-01-11 03:46:18.000</td>
      <td>1</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>2019-01-11 02:26:33.000</td>
      <td>1</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>2019-06-28 16:53:26.458</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建f = ,按&#x27;买家昵称&#x27;分组，按付款日期聚合</span></span><br><span class="line"></span><br><span class="line">f = dup_f.groupby(<span class="string">&#x27;买家昵称&#x27;</span>)[<span class="string">&#x27;付款日期&#x27;</span>].count().reset_index()</span><br><span class="line">f.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>付款日期</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>1</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>1</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将‘付款日期’替换为消费频率‘F‘</span></span><br><span class="line"></span><br><span class="line">f.columns = [<span class="string">&#x27;买家昵称&#x27;</span>,<span class="string">&#x27;F&#x27;</span>]</span><br><span class="line">f.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>F</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>1</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>1</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="M值：计算消费金额-x2F-次"><a href="#M值：计算消费金额-x2F-次" class="headerlink" title="M值：计算消费金额&#x2F;次"></a>M值：计算消费金额&#x2F;次</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 计算每个买家总消费金额:[&#x27;实付金额&#x27;].sum()</span></span><br><span class="line"></span><br><span class="line">sum_m = df.groupby(<span class="string">&#x27;买家昵称&#x27;</span>)[<span class="string">&#x27;实付金额&#x27;</span>].<span class="built_in">sum</span>().reset_index()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将[&#x27;实付金额&#x27;].sum()列更名为[&#x27;总支付金额&#x27;]</span></span><br><span class="line">sum_m.columns = [<span class="string">&#x27;买家昵称&#x27;</span>,<span class="string">&#x27;总支付金额&#x27;</span>]</span><br><span class="line">sum_m.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>总支付金额</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>49</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>183</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>34</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>37</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>164</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 合并表：sum_m和f</span></span><br><span class="line">com_m = pd.merge(sum_m,f,on = <span class="string">&#x27;买家昵称&#x27;</span>,how = <span class="string">&#x27;inner&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#计算用户平均支付金额,并定义为 ’M‘</span></span><br><span class="line">com_m[<span class="string">&#x27;M&#x27;</span>] = com_m[<span class="string">&#x27;总支付金额&#x27;</span>] / com_m[<span class="string">&#x27;F&#x27;</span>]</span><br><span class="line">com_m.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>总支付金额</th>
      <th>F</th>
      <th>M</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>49</td>
      <td>1</td>
      <td>49.0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>183</td>
      <td>1</td>
      <td>183.0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>34</td>
      <td>1</td>
      <td>34.0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>37</td>
      <td>1</td>
      <td>37.0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>164</td>
      <td>1</td>
      <td>164.0</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="三表合并，建立RFM表"><a href="#三表合并，建立RFM表" class="headerlink" title="三表合并，建立RFM表"></a>三表合并，建立RFM表</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rfm = pd.merge(r,com_m, on = <span class="string">&#x27;买家昵称&#x27;</span>, how= <span class="string">&#x27;inner&#x27;</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 选择需要的列</span></span><br><span class="line">rfm = rfm[[<span class="string">&#x27;买家昵称&#x27;</span>,<span class="string">&#x27;R&#x27;</span>,<span class="string">&#x27;F&#x27;</span>,<span class="string">&#x27;M&#x27;</span>]]</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rfm.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>R</th>
      <th>F</th>
      <th>M</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>146</td>
      <td>1</td>
      <td>49.0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>152</td>
      <td>1</td>
      <td>183.0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>170</td>
      <td>1</td>
      <td>34.0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>170</td>
      <td>1</td>
      <td>37.0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>2</td>
      <td>1</td>
      <td>164.0</td>
    </tr>
  </tbody>
</table>
</div>



<h1 id="打分框架确定"><a href="#打分框架确定" class="headerlink" title="打分框架确定"></a>打分框架确定</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># R值根据行业经验，设置为30天一个跨度，区间左闭右开：</span></span><br><span class="line"><span class="comment"># 1分-[120天,..); 2-[90,120);3-[60,90);4-[30,60);5-[0,30)</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># F值和购买频次挂钩，每多一次购买，分值就多加一分</span></span><br><span class="line"><span class="comment"># 1分-1次; 2分-2次;3分-3次;4分-4次;5分-[5,...)</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># M值做简单的区间统计，然后分组，这里我们按照50元的一个区间来进行划分：</span></span><br><span class="line"><span class="comment"># 1分-[0,50);2-[50,100);3-[100,150);4-[150,200);5-[200,250)</span></span><br></pre></td></tr></table></figure>

<h1 id="分值计算"><a href="#分值计算" class="headerlink" title="分值计算"></a>分值计算</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 区间计算分值：cut(要切分的数据列,bins-按照什么区间进行分组,labels,right-右侧区间是开还是闭)</span></span><br><span class="line"><span class="comment"># right如果设置成False，就代表[0,30)，包含左侧的分组数据而不含右侧，若设置为True，则是[0,30]，首尾都包含。</span></span><br><span class="line"><span class="comment"># pd.cut().astype(float),转为浮点数</span></span><br><span class="line"></span><br><span class="line">rfm[<span class="string">&#x27;R-Score&#x27;</span>] = pd.cut(rfm[<span class="string">&#x27;R&#x27;</span>],bins=[<span class="number">0</span>,<span class="number">30</span>,<span class="number">60</span>,<span class="number">90</span>,<span class="number">120</span>,<span class="number">10000000</span>],labels=[<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>],</span><br><span class="line">                        right = <span class="literal">False</span>).astype(<span class="built_in">float</span>)</span><br><span class="line">rfm.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>R</th>
      <th>F</th>
      <th>M</th>
      <th>R-Score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>146</td>
      <td>1</td>
      <td>49.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>152</td>
      <td>1</td>
      <td>183.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>170</td>
      <td>1</td>
      <td>34.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>170</td>
      <td>1</td>
      <td>37.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>2</td>
      <td>1</td>
      <td>164.0</td>
      <td>5.0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rfm[<span class="string">&#x27;F-SCORE&#x27;</span>] = pd.cut(rfm[<span class="string">&#x27;F&#x27;</span>],bins = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">1000000</span>],labels = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">                        right = <span class="literal">False</span>).astype(<span class="built_in">float</span>)</span><br><span class="line">rfm[<span class="string">&#x27;M-SCORE&#x27;</span>] = pd.cut(rfm[<span class="string">&#x27;M&#x27;</span>],bins = [<span class="number">0</span>,<span class="number">50</span>,<span class="number">100</span>,<span class="number">150</span>,<span class="number">200</span>,<span class="number">1000000</span>],labels = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">                        right = <span class="literal">False</span>).astype(<span class="built_in">float</span>)</span><br><span class="line">rfm.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>R</th>
      <th>F</th>
      <th>M</th>
      <th>R-Score</th>
      <th>F-SCORE</th>
      <th>M-SCORE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>146</td>
      <td>1</td>
      <td>49.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>152</td>
      <td>1</td>
      <td>183.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>170</td>
      <td>1</td>
      <td>34.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>170</td>
      <td>1</td>
      <td>37.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>2</td>
      <td>1</td>
      <td>164.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div>



<h1 id="客户分层"><a href="#客户分层" class="headerlink" title="客户分层"></a>客户分层</h1><h2 id="RFM各值与平均值比较"><a href="#RFM各值与平均值比较" class="headerlink" title="RFM各值与平均值比较"></a>RFM各值与平均值比较</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增加各分数与平均值对比列，减少客户分类数量</span></span><br><span class="line"></span><br><span class="line">rfm[<span class="string">&#x27;R是否大于均值&#x27;</span>] = (rfm[<span class="string">&#x27;R-Score&#x27;</span>] &gt; rfm[<span class="string">&#x27;R-Score&#x27;</span>].mean()) * <span class="number">1</span></span><br><span class="line">rfm[<span class="string">&#x27;F是否大于均值&#x27;</span>] = (rfm[<span class="string">&#x27;F-SCORE&#x27;</span>] &gt; rfm[<span class="string">&#x27;F-SCORE&#x27;</span>].mean()) * <span class="number">1</span></span><br><span class="line">rfm[<span class="string">&#x27;M是否大于均值&#x27;</span>] = (rfm[<span class="string">&#x27;M-SCORE&#x27;</span>] &gt; rfm[<span class="string">&#x27;M-SCORE&#x27;</span>].mean()) * <span class="number">1</span></span><br><span class="line">rfm.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>R</th>
      <th>F</th>
      <th>M</th>
      <th>R-Score</th>
      <th>F-SCORE</th>
      <th>M-SCORE</th>
      <th>R是否大于均值</th>
      <th>F是否大于均值</th>
      <th>M是否大于均值</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>146</td>
      <td>1</td>
      <td>49.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>152</td>
      <td>1</td>
      <td>183.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>170</td>
      <td>1</td>
      <td>34.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>170</td>
      <td>1</td>
      <td>37.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>2</td>
      <td>1</td>
      <td>164.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="RFM综合得分"><a href="#RFM综合得分" class="headerlink" title="RFM综合得分"></a>RFM综合得分</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为客户分类引入RFM综合评分项</span></span><br><span class="line"></span><br><span class="line">rfm[<span class="string">&#x27;RFM分数&#x27;</span>] = (rfm[<span class="string">&#x27;R是否大于均值&#x27;</span>] * <span class="number">100</span>) + (rfm[<span class="string">&#x27;F是否大于均值&#x27;</span>] * <span class="number">10</span>) + (rfm[<span class="string">&#x27;M是否大于均值&#x27;</span>] * <span class="number">1</span>)</span><br><span class="line">rfm.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>R</th>
      <th>F</th>
      <th>M</th>
      <th>R-Score</th>
      <th>F-SCORE</th>
      <th>M-SCORE</th>
      <th>R是否大于均值</th>
      <th>F是否大于均值</th>
      <th>M是否大于均值</th>
      <th>RFM分数</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>146</td>
      <td>1</td>
      <td>49.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>152</td>
      <td>1</td>
      <td>183.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>170</td>
      <td>1</td>
      <td>34.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>170</td>
      <td>1</td>
      <td>37.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>2</td>
      <td>1</td>
      <td>164.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>101</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="基于RFM得分，对客群分类贴标"><a href="#基于RFM得分，对客群分类贴标" class="headerlink" title="基于RFM得分，对客群分类贴标"></a>基于RFM得分，对客群分类贴标</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#判断R/F/M是否大于均值</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform_label</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">111</span>:</span><br><span class="line">        label = <span class="string">&#x27;重要价值客户&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> x == <span class="number">110</span>:</span><br><span class="line">        label = <span class="string">&#x27;消费潜力客户&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> x == <span class="number">101</span>:</span><br><span class="line">        label = <span class="string">&#x27;频次深耕客户&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> x == <span class="number">100</span>:</span><br><span class="line">        label = <span class="string">&#x27;新客户&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> x == <span class="number">11</span>:</span><br><span class="line">        label = <span class="string">&#x27;重要价值流失预警客户&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> x == <span class="number">10</span>:</span><br><span class="line">        label = <span class="string">&#x27;一般客户&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> x == <span class="number">1</span>:</span><br><span class="line">        label = <span class="string">&#x27;高消费唤回客户&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> x == <span class="number">0</span>:</span><br><span class="line">        label = <span class="string">&#x27;流失客户&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> label</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 贴标函数运用 apply.</span></span><br><span class="line"></span><br><span class="line">rfm[<span class="string">&#x27;人群类型&#x27;</span>] = rfm[<span class="string">&#x27;RFM分数&#x27;</span>].apply(transform_label)</span><br><span class="line">rfm.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>买家昵称</th>
      <th>R</th>
      <th>F</th>
      <th>M</th>
      <th>R-Score</th>
      <th>F-SCORE</th>
      <th>M-SCORE</th>
      <th>R是否大于均值</th>
      <th>F是否大于均值</th>
      <th>M是否大于均值</th>
      <th>RFM分数</th>
      <th>人群类型</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>.blue_ram</td>
      <td>146</td>
      <td>1</td>
      <td>49.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>流失客户</td>
    </tr>
    <tr>
      <td>1</td>
      <td>.christiny</td>
      <td>152</td>
      <td>1</td>
      <td>183.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>高消费唤回客户</td>
    </tr>
    <tr>
      <td>2</td>
      <td>.willn1</td>
      <td>170</td>
      <td>1</td>
      <td>34.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>流失客户</td>
    </tr>
    <tr>
      <td>3</td>
      <td>.托托m</td>
      <td>170</td>
      <td>1</td>
      <td>37.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>流失客户</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0000妮</td>
      <td>2</td>
      <td>1</td>
      <td>164.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>101</td>
      <td>频次深耕客户</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="统计客群人数和金额"><a href="#统计客群人数和金额" class="headerlink" title="统计客群人数和金额"></a>统计客群人数和金额</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 人数统计</span></span><br><span class="line"></span><br><span class="line">count = rfm[<span class="string">&#x27;人群类型&#x27;</span>].value_counts().reset_index()</span><br><span class="line">count.columns = [<span class="string">&#x27;客户类型&#x27;</span>,<span class="string">&#x27;人数&#x27;</span>]</span><br><span class="line">count[<span class="string">&#x27;人数占比&#x27;</span>] = count[<span class="string">&#x27;人数&#x27;</span>] / count[<span class="string">&#x27;人数&#x27;</span>].<span class="built_in">sum</span>()</span><br><span class="line">count</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>客户类型</th>
      <th>人数</th>
      <th>人数占比</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>高消费唤回客户</td>
      <td>7155</td>
      <td>0.281471</td>
    </tr>
    <tr>
      <td>1</td>
      <td>流失客户</td>
      <td>6671</td>
      <td>0.262431</td>
    </tr>
    <tr>
      <td>2</td>
      <td>频次深耕客户</td>
      <td>5350</td>
      <td>0.210464</td>
    </tr>
    <tr>
      <td>3</td>
      <td>新客户</td>
      <td>4218</td>
      <td>0.165932</td>
    </tr>
    <tr>
      <td>4</td>
      <td>重要价值客户</td>
      <td>811</td>
      <td>0.031904</td>
    </tr>
    <tr>
      <td>5</td>
      <td>重要价值流失预警客户</td>
      <td>486</td>
      <td>0.019119</td>
    </tr>
    <tr>
      <td>6</td>
      <td>消费潜力客户</td>
      <td>478</td>
      <td>0.018804</td>
    </tr>
    <tr>
      <td>7</td>
      <td>一般客户</td>
      <td>251</td>
      <td>0.009874</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 消费金额统计</span></span><br><span class="line"></span><br><span class="line">rfm[<span class="string">&#x27;购买总金额&#x27;</span>] = rfm[<span class="string">&#x27;F&#x27;</span>] * rfm[<span class="string">&#x27;M&#x27;</span>]</span><br><span class="line">mon = rfm.groupby(<span class="string">&#x27;人群类型&#x27;</span>)[<span class="string">&#x27;购买总金额&#x27;</span>].<span class="built_in">sum</span>().reset_index()</span><br><span class="line">mon.columns = [<span class="string">&#x27;客户类型&#x27;</span>,<span class="string">&#x27;消费金额&#x27;</span>]</span><br><span class="line">mon[<span class="string">&#x27;金额占比&#x27;</span>] = mon[<span class="string">&#x27;消费金额&#x27;</span>] / mon[<span class="string">&#x27;消费金额&#x27;</span>].<span class="built_in">sum</span>()</span><br><span class="line">mon</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>客户类型</th>
      <th>消费金额</th>
      <th>金额占比</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>一般客户</td>
      <td>35948.0</td>
      <td>0.010238</td>
    </tr>
    <tr>
      <td>1</td>
      <td>新客户</td>
      <td>270412.0</td>
      <td>0.077012</td>
    </tr>
    <tr>
      <td>2</td>
      <td>流失客户</td>
      <td>443863.0</td>
      <td>0.126410</td>
    </tr>
    <tr>
      <td>3</td>
      <td>消费潜力客户</td>
      <td>68422.0</td>
      <td>0.019486</td>
    </tr>
    <tr>
      <td>4</td>
      <td>重要价值客户</td>
      <td>286705.0</td>
      <td>0.081652</td>
    </tr>
    <tr>
      <td>5</td>
      <td>重要价值流失预警客户</td>
      <td>156674.0</td>
      <td>0.044620</td>
    </tr>
    <tr>
      <td>6</td>
      <td>频次深耕客户</td>
      <td>960528.0</td>
      <td>0.273553</td>
    </tr>
    <tr>
      <td>7</td>
      <td>高消费唤回客户</td>
      <td>1288753.0</td>
      <td>0.367030</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result = pd.merge(count,mon, on = <span class="string">&#x27;客户类型&#x27;</span>)</span><br><span class="line">result</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>客户类型</th>
      <th>人数</th>
      <th>人数占比</th>
      <th>消费金额</th>
      <th>金额占比</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>高消费唤回客户</td>
      <td>7155</td>
      <td>0.281471</td>
      <td>1288753.0</td>
      <td>0.367030</td>
    </tr>
    <tr>
      <td>1</td>
      <td>流失客户</td>
      <td>6671</td>
      <td>0.262431</td>
      <td>443863.0</td>
      <td>0.126410</td>
    </tr>
    <tr>
      <td>2</td>
      <td>频次深耕客户</td>
      <td>5350</td>
      <td>0.210464</td>
      <td>960528.0</td>
      <td>0.273553</td>
    </tr>
    <tr>
      <td>3</td>
      <td>新客户</td>
      <td>4218</td>
      <td>0.165932</td>
      <td>270412.0</td>
      <td>0.077012</td>
    </tr>
    <tr>
      <td>4</td>
      <td>重要价值客户</td>
      <td>811</td>
      <td>0.031904</td>
      <td>286705.0</td>
      <td>0.081652</td>
    </tr>
    <tr>
      <td>5</td>
      <td>重要价值流失预警客户</td>
      <td>486</td>
      <td>0.019119</td>
      <td>156674.0</td>
      <td>0.044620</td>
    </tr>
    <tr>
      <td>6</td>
      <td>消费潜力客户</td>
      <td>478</td>
      <td>0.018804</td>
      <td>68422.0</td>
      <td>0.019486</td>
    </tr>
    <tr>
      <td>7</td>
      <td>一般客户</td>
      <td>251</td>
      <td>0.009874</td>
      <td>35948.0</td>
      <td>0.010238</td>
    </tr>
  </tbody>
</table>
</div>



<h1 id="模型代码写入函数"><a href="#模型代码写入函数" class="headerlink" title="模型代码写入函数"></a>模型代码写入函数</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#输入数据文件名</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_rfm</span>(<span class="params">name = <span class="string">&#x27;电商用户RFM分析.xlsx&#x27;</span></span>):</span><br><span class="line">    df = pd.read_excel(name)</span><br><span class="line">    df = df.loc[df[<span class="string">&#x27;订单状态&#x27;</span>] == <span class="string">&#x27;交易成功&#x27;</span>,:]</span><br><span class="line">   </span><br><span class="line">    df = df[[<span class="string">&#x27;买家昵称&#x27;</span>,<span class="string">&#x27;付款日期&#x27;</span>,<span class="string">&#x27;实付金额&#x27;</span>]]</span><br><span class="line"></span><br><span class="line">    r = df.groupby(<span class="string">&#x27;买家昵称&#x27;</span>)[<span class="string">&#x27;付款日期&#x27;</span>].<span class="built_in">max</span>().reset_index()</span><br><span class="line">    r[<span class="string">&#x27;R&#x27;</span>] = (pd.to_datetime(<span class="string">&#x27;2019-7-1&#x27;</span>) - r[<span class="string">&#x27;付款日期&#x27;</span>]).dt.days</span><br><span class="line">    r = r[[<span class="string">&#x27;买家昵称&#x27;</span>,<span class="string">&#x27;R&#x27;</span>]]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#引入日期标签列</span></span><br><span class="line">    df[<span class="string">&#x27;日期标签&#x27;</span>] = df[<span class="string">&#x27;付款日期&#x27;</span>].astype(<span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#单个用户一天内订单合并</span></span><br><span class="line">    dup_f = df.groupby([<span class="string">&#x27;买家昵称&#x27;</span>,<span class="string">&#x27;日期标签&#x27;</span>])[<span class="string">&#x27;付款日期&#x27;</span>].count().reset_index()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#对合并后的用户统计频次</span></span><br><span class="line">    f = dup_f.groupby(<span class="string">&#x27;买家昵称&#x27;</span>)[<span class="string">&#x27;付款日期&#x27;</span>].count().reset_index()</span><br><span class="line">    f.columns = [<span class="string">&#x27;买家昵称&#x27;</span>,<span class="string">&#x27;F&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    sum_m = df.groupby(<span class="string">&#x27;买家昵称&#x27;</span>)[<span class="string">&#x27;实付金额&#x27;</span>].<span class="built_in">sum</span>().reset_index()</span><br><span class="line">    sum_m.columns = [<span class="string">&#x27;买家昵称&#x27;</span>,<span class="string">&#x27;总支付金额&#x27;</span>]</span><br><span class="line">    com_m = pd.merge(sum_m,f,left_on = <span class="string">&#x27;买家昵称&#x27;</span>,right_on = <span class="string">&#x27;买家昵称&#x27;</span>,how = <span class="string">&#x27;inner&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#计算用户平均支付金额</span></span><br><span class="line">    com_m[<span class="string">&#x27;M&#x27;</span>] = com_m[<span class="string">&#x27;总支付金额&#x27;</span>] / com_m[<span class="string">&#x27;F&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    rfm = pd.merge(r,com_m,left_on = <span class="string">&#x27;买家昵称&#x27;</span>,right_on = <span class="string">&#x27;买家昵称&#x27;</span>,how = <span class="string">&#x27;inner&#x27;</span>)</span><br><span class="line">    rfm = rfm[[<span class="string">&#x27;买家昵称&#x27;</span>,<span class="string">&#x27;R&#x27;</span>,<span class="string">&#x27;F&#x27;</span>,<span class="string">&#x27;M&#x27;</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    rfm[<span class="string">&#x27;R-SCORE&#x27;</span>] = pd.cut(rfm[<span class="string">&#x27;R&#x27;</span>],bins = [<span class="number">0</span>,<span class="number">30</span>,<span class="number">60</span>,<span class="number">90</span>,<span class="number">120</span>,<span class="number">1000000</span>],labels = [<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>],right = <span class="literal">False</span>).astype(<span class="built_in">float</span>)</span><br><span class="line">    rfm[<span class="string">&#x27;F-SCORE&#x27;</span>] = pd.cut(rfm[<span class="string">&#x27;F&#x27;</span>],bins = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">1000000</span>],labels = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],right = <span class="literal">False</span>).astype(<span class="built_in">float</span>)</span><br><span class="line">    rfm[<span class="string">&#x27;M-SCORE&#x27;</span>] = pd.cut(rfm[<span class="string">&#x27;M&#x27;</span>],bins = [<span class="number">0</span>,<span class="number">50</span>,<span class="number">100</span>,<span class="number">150</span>,<span class="number">200</span>,<span class="number">1000000</span>],labels = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],right = <span class="literal">False</span>).astype(<span class="built_in">float</span>)</span><br><span class="line"></span><br><span class="line">    rfm[<span class="string">&#x27;R是否大于均值&#x27;</span>] = (rfm[<span class="string">&#x27;R-SCORE&#x27;</span>] &gt; rfm[<span class="string">&#x27;R-SCORE&#x27;</span>].mean()) * <span class="number">1</span></span><br><span class="line">    rfm[<span class="string">&#x27;F是否大于均值&#x27;</span>] = (rfm[<span class="string">&#x27;F-SCORE&#x27;</span>] &gt; rfm[<span class="string">&#x27;F-SCORE&#x27;</span>].mean()) * <span class="number">1</span></span><br><span class="line">    rfm[<span class="string">&#x27;M是否大于均值&#x27;</span>] = (rfm[<span class="string">&#x27;M-SCORE&#x27;</span>] &gt; rfm[<span class="string">&#x27;M-SCORE&#x27;</span>].mean()) * <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    rfm[<span class="string">&#x27;RMF分数&#x27;</span>] = (rfm[<span class="string">&#x27;R是否大于均值&#x27;</span>] * <span class="number">100</span>) + (rfm[<span class="string">&#x27;F是否大于均值&#x27;</span>] * <span class="number">10</span>) + (rfm[<span class="string">&#x27;M是否大于均值&#x27;</span>] * <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    rfm[<span class="string">&#x27;人群类型&#x27;</span>] = rfm[<span class="string">&#x27;RMF分数&#x27;</span>].apply(transform_label)</span><br><span class="line"></span><br><span class="line">    count = rfm[<span class="string">&#x27;人群类型&#x27;</span>].value_counts().reset_index()</span><br><span class="line">    count.columns = [<span class="string">&#x27;客户类型&#x27;</span>,<span class="string">&#x27;人数&#x27;</span>]</span><br><span class="line">    count[<span class="string">&#x27;人数占比&#x27;</span>] = count[<span class="string">&#x27;人数&#x27;</span>] / count[<span class="string">&#x27;人数&#x27;</span>].<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line">    rfm[<span class="string">&#x27;购买总金额&#x27;</span>] = rfm[<span class="string">&#x27;F&#x27;</span>] * rfm[<span class="string">&#x27;M&#x27;</span>]</span><br><span class="line">    mon = rfm.groupby(<span class="string">&#x27;人群类型&#x27;</span>)[<span class="string">&#x27;购买总金额&#x27;</span>].<span class="built_in">sum</span>().reset_index()</span><br><span class="line">    mon.columns = [<span class="string">&#x27;客户类型&#x27;</span>,<span class="string">&#x27;消费金额&#x27;</span>]</span><br><span class="line">    mon[<span class="string">&#x27;金额占比&#x27;</span>] = mon[<span class="string">&#x27;消费金额&#x27;</span>] / mon[<span class="string">&#x27;消费金额&#x27;</span>].<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line">    result = pd.merge(count,mon,left_on = <span class="string">&#x27;客户类型&#x27;</span>,right_on = <span class="string">&#x27;客户类型&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#判断R/F/M是否大于均值</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform_label</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">111</span>:</span><br><span class="line">        label = <span class="string">&#x27;重要价值客户&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> x == <span class="number">110</span>:</span><br><span class="line">        label = <span class="string">&#x27;消费潜力客户&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> x == <span class="number">101</span>:</span><br><span class="line">        label = <span class="string">&#x27;频次深耕客户&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> x == <span class="number">100</span>:</span><br><span class="line">        label = <span class="string">&#x27;新客户&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> x == <span class="number">11</span>:</span><br><span class="line">        label = <span class="string">&#x27;重要价值流失预警客户&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> x == <span class="number">10</span>:</span><br><span class="line">        label = <span class="string">&#x27;一般客户&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> x == <span class="number">1</span>:</span><br><span class="line">        label = <span class="string">&#x27;高消费唤回客户&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> x == <span class="number">0</span>:</span><br><span class="line">        label = <span class="string">&#x27;流失客户&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> label</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re_rfm = get_rfm(name = <span class="string">&#x27;电商用户RFM分析.xlsx&#x27;</span>)</span><br><span class="line">re_rfm</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>客户类型</th>
      <th>人数</th>
      <th>人数占比</th>
      <th>消费金额</th>
      <th>金额占比</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>高消费唤回客户</td>
      <td>7155</td>
      <td>0.281471</td>
      <td>1288753.0</td>
      <td>0.367030</td>
    </tr>
    <tr>
      <td>1</td>
      <td>流失客户</td>
      <td>6671</td>
      <td>0.262431</td>
      <td>443863.0</td>
      <td>0.126410</td>
    </tr>
    <tr>
      <td>2</td>
      <td>频次深耕客户</td>
      <td>5350</td>
      <td>0.210464</td>
      <td>960528.0</td>
      <td>0.273553</td>
    </tr>
    <tr>
      <td>3</td>
      <td>新客户</td>
      <td>4218</td>
      <td>0.165932</td>
      <td>270412.0</td>
      <td>0.077012</td>
    </tr>
    <tr>
      <td>4</td>
      <td>重要价值客户</td>
      <td>811</td>
      <td>0.031904</td>
      <td>286705.0</td>
      <td>0.081652</td>
    </tr>
    <tr>
      <td>5</td>
      <td>重要价值流失预警客户</td>
      <td>486</td>
      <td>0.019119</td>
      <td>156674.0</td>
      <td>0.044620</td>
    </tr>
    <tr>
      <td>6</td>
      <td>消费潜力客户</td>
      <td>478</td>
      <td>0.018804</td>
      <td>68422.0</td>
      <td>0.019486</td>
    </tr>
    <tr>
      <td>7</td>
      <td>一般客户</td>
      <td>251</td>
      <td>0.009874</td>
      <td>35948.0</td>
      <td>0.010238</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"># Python</a>
              <a href="/tags/CRM/" rel="tag"># CRM</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/12/26/data%20analysis6/" rel="prev" title="E-commerce TGI analysis">
                  <i class="fa fa-chevron-left"></i> E-commerce TGI analysis
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/02/16/data%20analysis4/" rel="next" title="Customer portfolio analysis_MySQL">
                  Customer portfolio analysis_MySQL <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Huifeng (Kiran) Li</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
